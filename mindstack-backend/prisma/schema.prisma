generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ================= ENUMS (Opções Fixas) =================
enum TipoCurso {
  GRADUACAO
  POS_GRADUACAO
  CURSO_LIVRE
  CERTIFICACAO
}

enum StatusCurso {
  EM_ANDAMENTO
  CONCLUIDO
  PAUSADO
}

enum StatusPresenca {
  PENDENTE
  PRESENTE
  FALTA
  ASSISTIDA_GRAVADA 
}

enum StatusTarefa {
  PENDENTE
  FAZENDO
  CONCLUIDA
  ATRASADA
}

// ================= TABELAS =================

model Usuario {
  id        String   @id @default(uuid())
  nome      String
  email     String   @unique
  senha     String
  createdAt DateTime @default(now())

  // Relacionamentos
  cursos      Curso[]
  disciplinas Disciplina[]
  aulas       Aula[]
  tarefas     Tarefa[]
}

model Curso {
  id         String      @id @default(uuid())
  titulo     String
  plataforma String     
  tipo       TipoCurso
  status     StatusCurso @default(EM_ANDAMENTO)
  
  usuarioId  String
  usuario    Usuario     @relation(fields: [usuarioId], references: [id])

  disciplinas Disciplina[]
  createdAt   DateTime    @default(now())
}

model Disciplina {
  id             String  @id @default(uuid())
  nome           String
  professor      String?
  maxFaltasPermitidas Int?
  
  cursoId        String
  curso          Curso   @relation(fields: [cursoId], references: [id], onDelete: Cascade)
  
  usuarioId      String
  usuario        Usuario @relation(fields: [usuarioId], references: [id])

  aulas          Aula[]
  notas          Nota[]
  tarefas        Tarefa[]
  resumos        Resumo[]
}

model Aula {
  id           String         @id @default(uuid())
  titulo       String         
  dataHora     DateTime?      
  linkVideo    String?        
  status       StatusPresenca @default(PENDENTE) // Controle de Faltas
  
  disciplinaId String
  disciplina   Disciplina     @relation(fields: [disciplinaId], references: [id], onDelete: Cascade)

  usuarioId    String
  usuario      Usuario        @relation(fields: [usuarioId], references: [id])

  resumos      Resumo[]       
}

model Nota {
  id           String     @id @default(uuid())
  nomeProva    String     // Ex: "N1", "Projeto Final"
  notaObtida   Float
  peso         Float?     @default(1.0)
  
  disciplinaId String
  disciplina   Disciplina @relation(fields: [disciplinaId], references: [id], onDelete: Cascade)
}

model Tarefa {
  id           String       @id @default(uuid())
  titulo       String
  descricao    String?
  dataEntrega  DateTime
  status       StatusTarefa @default(PENDENTE)

  disciplinaId String
  disciplina   Disciplina   @relation(fields: [disciplinaId], references: [id], onDelete: Cascade)

  usuarioId    String
  usuario      Usuario      @relation(fields: [usuarioId], references: [id])
}

model Resumo {
  id              String      @id @default(uuid())
  conteudo        String
  tamanhoOriginal Int
  
  disciplinaId    String
  disciplina      Disciplina  @relation(fields: [disciplinaId], references: [id], onDelete: Cascade)

  aulaId          String?     
  aula            Aula?       @relation(fields: [aulaId], references: [id])
  
  createdAt       DateTime    @default(now())
}