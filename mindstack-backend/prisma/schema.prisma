generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ================= ENUMS (Opções Fixas) =================
enum TipoCurso {
  GRADUACAO
  POS_GRADUACAO
  CURSO_LIVRE
  CERTIFICACAO
}

enum StatusCurso {
  EM_ANDAMENTO
  CONCLUIDO
  PAUSADO
}

enum StatusPresenca {
  PENDENTE
  PRESENTE
  FALTA
  ASSISTIDA_GRAVADA 
}

enum StatusTarefa {
  PENDENTE
  FAZENDO
  CONCLUIDA
  ATRASADA
}

// ================= TABELAS =================

model Usuario {
  id        String   @id @default(uuid())
  nome      String
  email     String   @unique
  senha     String
  createdAt DateTime @default(now())

  // Relacionamentos
  cursos      Curso[]
  disciplinas Disciplina[]
  aulas       Aula[]
  tarefas     Tarefa[]
  notificacoes Notificacao[]
}

model Curso {
  id         String      @id @default(uuid())
  titulo     String
  plataforma String     
  tipo       TipoCurso
  status     StatusCurso @default(EM_ANDAMENTO)
  
  usuarioId  String
  usuario    Usuario     @relation(fields: [usuarioId], references: [id])

  disciplinas Disciplina[]
  createdAt   DateTime    @default(now())
}

model Disciplina {
  id             String  @id @default(uuid())
  nome           String
  professor      String?
  maxFaltasPermitidas Int?
  
  cursoId        String
  curso          Curso   @relation(fields: [cursoId], references: [id], onDelete: Cascade)
  
  usuarioId      String
  usuario        Usuario @relation(fields: [usuarioId], references: [id])

  aulas          Aula[]
  notas          Nota[]
  tarefas        Tarefa[]
  resumos        Resumo[]
}

model Aula {
  id           String         @id @default(uuid())
  titulo       String         
  dataHora     DateTime?      
  linkVideo    String?        
  status       StatusPresenca @default(PENDENTE) // Controle de Faltas
  
  disciplinaId String
  disciplina   Disciplina     @relation(fields: [disciplinaId], references: [id], onDelete: Cascade)

  usuarioId    String
  usuario      Usuario        @relation(fields: [usuarioId], references: [id])

  resumos      Resumo[]       
}

model Nota {
  id           String     @id @default(uuid())
  nomeProva    String     // Ex: "N1", "Projeto Final"
  notaObtida   Float
  peso         Float?     @default(1.0)
  
  disciplinaId String
  disciplina   Disciplina @relation(fields: [disciplinaId], references: [id], onDelete: Cascade)
}


model Resumo {
  id              String      @id @default(uuid())
  conteudo        String
  tamanhoOriginal Int
  
  disciplinaId    String
  disciplina      Disciplina  @relation(fields: [disciplinaId], references: [id], onDelete: Cascade)

  aulaId          String?     
  aula            Aula?       @relation(fields: [aulaId], references: [id])
  
  createdAt       DateTime    @default(now())
}

model Notificacao {
  id        String   @id @default(uuid())
  titulo    String
  mensagem  String
  lida      Boolean  @default(false)
  
  // Relacionamento com o Usuário que vai receber o aviso
  usuario   Usuario  @relation(fields: [usuarioId], references: [id])
  usuarioId String
  
  createdAt DateTime @default(now())
}

model Tarefa {
  id          String   @id @default(uuid())
  titulo      String
  descricao   String?  // Opcional, para detalhes da tarefa
  status      String   @default("TODO") // Valores esperados: "TODO", "IN_PROGRESS", "DONE"
  dataEntrega  DateTime? 
  ordem        Int         @default(0)
  recorrente   Boolean     @default(false)
  
  // Uma tarefa pertence a um usuário
  usuarioId   String
  usuario     Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  // (Opcional) Podemos vincular a tarefa a uma disciplina específica
  disciplinaId String?
  disciplina   Disciplina? @relation(fields: [disciplinaId], references: [id], onDelete: SetNull)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}